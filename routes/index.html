<!doctype html>  
<html lang="en">  
    <head>

    </head>
    <body>
        <h1>Remote Camera Control</h1>
        <div id = "cameras"></div>      
    </body>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>  
        var control = io.connect('/controller');
        control.on('connect', function(socket) {
            console.log("Controller connected");
        });
        control.on('status', function (status) {
            console.log("Got status for " + status.id + " - " + status.active)
            cameraList[parseInt(status.id)].active = status.active;
            listCameras(cameraList);
        })
        control.on('list', function (cameras) {
            cameraList = cameras;
            listCameras(cameras);
        });
        function listCameras(cameras) {
            var $cameraList = $("<ul>", {id: "camera-list"});
            cameras.forEach(function (camera) {
                var $camera = $("<li>", {text: camera.name});
                var $button = $("<button>", {text: camera.active?"Disable":"Enable", 'data-camera-id': camera.id})
                $button.click(toggleStatus);
                $camera.append($button);
                $cameraList.append($camera)          
            })
            $('#camera-list').remove();
            $('#cameras').append($cameraList);
        }

        function toggleStatus(evt) {
            var cameraId = this.dataset.cameraId;
            var event = cameraList[cameraId].active?'deactivate':'activate';
            control.emit(event, {id: cameraId});
            return false;
        }

    </script>
</html>  